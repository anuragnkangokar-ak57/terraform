Why Use Multi-Cloud Deployment?
1. Avoid Vendor Lock-In
You don’t become overly dependent on a single cloud provider.

If one provider changes pricing, features, or terms, you can shift or scale on another.

Example: Run your app on AWS, but replicate it to Azure as a backup.

2. Improve Availability & Resilience
You reduce your risk of global outages affecting your services.

Even if AWS has a region-wide or global issue, your Azure resources remain unaffected.

Example: Run production in AWS, failover to Azure in disaster recovery.

3. Geographic Flexibility
Some regions may have better coverage or data centers on one cloud.

You can place workloads close to users, even if it means using different clouds.

Example: Use Azure for Africa/Middle East users, AWS for North America.


#####################
# PROVIDERS
#####################

provider "aws" {
  region = var.aws_region
}

provider "azurerm" {
  features {}
  subscription_id = var.azure_subscription_id
  client_id       = var.azure_client_id
  client_secret   = var.azure_client_secret
  tenant_id       = var.azure_tenant_id
}

#####################
# VARIABLES
#####################

variable "aws_region" {
  default = "us-east-1"
}

variable "aws_ami" {
  default = "ami-0c94855ba95c71c99" # Amazon Linux 2 for us-east-1
}

variable "azure_location" {
  default = "East US"
}

variable "azure_subscription_id" {}
variable "azure_client_id" {}
variable "azure_client_secret" {}
variable "azure_tenant_id" {}

#####################
# AWS EC2 INSTANCE
#####################

resource "aws_instance" "aws_vm" {
  ami           = var.aws_ami
  instance_type = "t2.micro"

  tags = {
    Name = "AWS-VM"
  }
}

#####################
# AZURE VIRTUAL MACHINE
#####################

resource "azurerm_resource_group" "rg" {
  name     = "multi-cloud-rg"
  location = var.azure_location
}

resource "azurerm_virtual_network" "vnet" {
  name                = "multi-cloud-vnet"
  address_space       = ["10.0.0.0/16"]
  location            = var.azure_location
  resource_group_name = azurerm_resource_group.rg.name
}

resource "azurerm_subnet" "subnet" {
  name                 = "internal"
  resource_group_name  = azurerm_resource_group.rg.name
  virtual_network_name = azurerm_virtual_network.vnet.name
  address_prefixes     = ["10.0.2.0/24"]
}

resource "azurerm_network_interface" "nic" {
  name                = "multi-cloud-nic"
  location            = var.azure_location
  resource_group_name = azurerm_resource_group.rg.name

  ip_configuration {
    name                          = "internal"
    subnet_id                     = azurerm_subnet.subnet.id
    private_ip_address_allocation = "Dynamic"
  }
}

resource "azurerm_linux_virtual_machine" "azure_vm" {
  name                = "Azure-VM"
  resource_group_name = azurerm_resource_group.rg.name
  location            = var.azure_location
  size                = "Standard_B1s"
  admin_username      = "azureuser"
  network_interface_ids = [
    azurerm_network_interface.nic.id
  ]
  admin_password = "P@ssword1234!" # Only for demo — use SSH or Key Vault in production

  os_disk {
    caching              = "ReadWrite"
    storage_account_type = "Standard_LRS"
    name                 = "osdisk"
  }

  source_image_reference {
    publisher = "Canonical"
    offer     = "UbuntuServer"
    sku       = "18.04-LTS"
    version   = "latest"
  }
}

#####################
# OUTPUTS
#####################

output "aws_instance_id" {
  value = aws_instance.aws_vm.id
}

output "azure_vm_id" {
  value = azurerm_linux_virtual_machine.azure_vm.id
}
